<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ application_name }}</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  <!-- Application -->
  <style>
    #console {
      background-color: black;
      color: white;
      font-family: "Lucida Console", Monaco, monospace;
    }
  </style>
</head>
<body>

  <!-- navbar -->
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">{{ application_name }}</a>
      </div>
    </div>
  </nav>

  <!-- main content -->
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading">Controls</div>
          <div class="panel-body">
            <button id="send-greeting-button" class="btn btn-default" type="submit">Send Greeting</button>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <div class="panel panel-default">
          <div class="panel-heading">Status</div>
          <div class="panel-body">
            <div>
              Admin Server Connection Status: <span id="admin-server-connection-status">Unknown</span>
            </div>
            <div>
              Device Connection Status: <span id="device-connection-status">Unknown</span>
            </div>
            <div>
              Device ID: <span id="device-id">Unknown</span>
            </div>
            <textarea id="console" class="form-control" rows="10"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

  <!-- Bootstrap -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
          integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
          crossorigin="anonymous"></script>

  <!-- Socket.io -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"
          integrity="sha256-sdmLD9jD1PIzq3KOQPNSGZYxjv76rds79Mnyk5JNp1M="
          crossorigin="anonymous"></script>

  <!-- moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.js"
          integrity="sha256-GSRe5cHmmTD3DgBxRifzkNLaW1iwPTzt9kJ86rGa8tg="
          crossorigin="anonymous"></script>

  <!-- Application -->
  <script>
    function logConsoleMessage(message) {
      var date = moment().format('YYYY-MM-DD HH:mm:ss.SSS')
      var consoleMessage = date + ': ' + message;
      var oldValue = $('#console').val();

      // only add a new line if there was previous contents
      var newValue;

      if (oldValue) {
        newValue = oldValue + '\n' + consoleMessage;
      } else {
        newValue = consoleMessage;
      }

      $('#console').val(newValue);
    }

    $('#send-greeting-button').click(function(event) {
      alert('Hello');
    });

    var socket = io.connect('http://ec2-54-209-250-166.compute-1.amazonaws.com:8888');

    socket.on('connect', function() {
      $('#admin-server-connection-status').text('Connected');
      $('#admin-server-connection-status').css('color', 'green');
      logConsoleMessage('Connected');

      socket.emit('state_request');
      logConsoleMessage('state request sent');
    });

    socket.on('disconnect', function(){
      $('#admin-server-connection-status').text('Disconnected');
      $('#admin-server-connection-status').css('color', 'red');
      logConsoleMessage('Disconnected');
    });

    socket.on('state_response', function(data) {
      logConsoleMessage('state response received');

      var stateResponse = JSON.parse(data);
      var deviceConnectionStatus = stateResponse.device_connection_status;
      var deviceId = stateResponse.device_id;

      // apply device connection status
      $('#device-connection-status').text(deviceConnectionStatus);

      // apply device id
      $('#device-id').text(deviceId);
    });
  </script>
</body>
</html>
